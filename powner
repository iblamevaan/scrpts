--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer

--// Safety
if not player then return end

--// Ownership tracking (prevents spam)
local owned = setmetatable({}, { _mode = "k" })

--// Fast ownership check
local function canTakeOwnership(part)
    return part:IsA("BasePart")
        and not part.Anchored
        and not owned[part]
end

--// Instant ownership attempt
local function takeOwnership(part)
    if not canTakeOwnership(part) then return end

    -- exploit-supported methods
    pcall(function()
        if part.SetNetworkOwner then
            part:SetNetworkOwner(player)
        elseif typeof(sethiddenproperty) == "function" then
            sethiddenproperty(player, "NetworkOwnership", part)
        end
    end)

    owned[part] = true
end

--// Claim ALL existing unanchored parts immediately
for , inst in ipairs(Workspace:GetDescendants()) do
    takeOwnership(inst)
end

--// INSTANT: when a part is added
Workspace.DescendantAdded:Connect(function(inst)
    takeOwnership(inst)

    -- INSTANT: if it later becomes unanchored
    if inst:IsA("BasePart") then
        inst:GetPropertyChangedSignal("Anchored"):Connect(function()
            if not inst.Anchored then
                takeOwnership(inst)
            end
        end)
    end
end)

--// INSTANT proximity claim (no delay, no loop spam)
RunService.Stepped:Connect(function()
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local pos = hrp.Position
    local radius = 60

    for _, inst in ipairs(Workspace:GetDescendants()) do
        if inst:IsA("BasePart") and not owned[inst] and not inst.Anchored then
            if (inst.Position - pos).Magnitude <= radius then
                takeOwnership(inst)
            end
        end
    end
end)
